-- Add price column to order_items
ALTER TABLE "public"."order_items" ADD  "price" NUMERIC(10,2) NOT NULL;
ALTER TABLE order_items ADD COLUMN IF NOT EXISTS price NUMERIC;

-- Update existing records with price from products table
UPDATE order_items oi
SET price = p.price
FROM products p
WHERE oi.product_id = p.product_id
  AND oi.price IS NULL;

-- verify
SELECT COUNT(*) AS null_prices
FROM order_items
WHERE price IS NULL;

-- Prevents negative prices:
ALTER TABLE order_items
ADD CONSTRAINT order_items_price_positive
CHECK (price >= 0);

-- Seed data for order_items with price
INSERT INTO order_items (order_id, product_id, quantity, price) VALUES

(9,1,2,19.99),(9,5,1,49.99),(9,8,1,89.99),(9,11,2,29.99),
(10,2,1,39.99),(10,6,1,59.99),(10,9,1,120.00),(10,12,2,34.99),
(11,3,2,24.99),(11,7,1,44.99),(11,10,1,69.99),(11,13,1,19.99),
(12,4,1,29.99),(12,5,2,49.99),(12,8,1,89.99),(12,14,1,49.99),
(13,1,1,19.99),(13,6,1,59.99),(13,9,2,120.00),(13,11,1,29.99),

(14,2,2,39.99),(14,7,1,44.99),(14,10,1,69.99),(14,12,1,34.99),
(15,3,1,24.99),(15,5,1,49.99),(15,8,2,89.99),(15,13,1,19.99),
(16,4,2,29.99),(16,6,1,59.99),(16,9,1,120.00),(16,14,1,49.99),
(17,1,1,19.99),(17,7,2,44.99),(17,10,1,69.99),(17,11,1,29.99),
(18,2,1,39.99),(18,5,2,49.99),(18,8,1,89.99),(18,12,1,34.99),

(19,3,2,24.99),(19,6,1,59.99),(19,9,1,120.00),(19,13,1,19.99),
(20,4,1,29.99),(20,7,1,44.99),(20,10,2,69.99),(20,14,1,49.99),
(21,1,2,19.99),(21,5,1,49.99),(21,8,1,89.99),(21,11,1,29.99),
(22,2,1,39.99),(22,6,2,59.99),(22,9,1,120.00),(22,12,1,34.99),
(23,3,1,24.99),(23,7,1,44.99),(23,10,1,69.99),(23,13,2,19.99),

(24,4,2,29.99),(24,5,1,49.99),(24,8,1,89.99),(24,14,1,49.99),
(25,1,1,19.99),(25,6,1,59.99),(25,9,2,120.00),(25,11,1,29.99),
(26,2,2,39.99),(26,7,1,44.99),(26,10,1,69.99),(26,12,1,34.99),
(27,3,1,24.99),(27,5,2,49.99),(27,8,1,89.99),(27,13,1,19.99),
(28,4,1,29.99),(28,6,1,59.99),(28,9,1,120.00),(28,14,2,49.99),

(29,1,2,19.99),(29,7,1,44.99),(29,10,1,69.99),(29,11,1,29.99),
(30,2,1,39.99),(30,5,1,49.99),(30,8,2,89.99),(30,12,1,34.99),
(31,3,2,24.99),(31,6,1,59.99),(31,9,1,120.00),(31,13,1,19.99),
(32,4,1,29.99),(32,7,2,44.99),(32,10,1,69.99),(32,14,1,49.99),
(33,1,1,19.99),(33,5,1,49.99),(33,8,1,89.99),(33,11,2,29.99),

(34,2,2,39.99),(34,6,1,59.99),(34,9,1,120.00),(34,12,1,34.99),
(35,3,1,24.99),(35,7,1,44.99),(35,10,2,69.99),(35,13,1,19.99),
(36,4,2,29.99),(36,5,1,49.99),(36,8,1,89.99),(36,14,1,49.99),
(37,1,1,19.99),(37,6,2,59.99),(37,9,1,120.00),(37,11,1,29.99),
(38,2,1,39.99),(38,7,2,44.99),(38,10,1,69.99),(38,12,1,34.99),

(39,3,2,24.99),(39,5,1,49.99),(39,8,1,89.99),(39,13,1,19.99),
(40,4,1,29.99),(40,6,1,59.99),(40,9,2,120.00),(40,14,1,49.99),
(41,1,2,19.99),(41,7,1,44.99),(41,10,1,69.99),(41,11,1,29.99),
(42,2,1,39.99),(42,5,1,49.99),(42,8,2,89.99),(42,12,1,34.99),
(43,3,2,24.99),(43,6,1,59.99),(43,9,1,120.00),(43,13,1,19.99),

(44,4,1,29.99),(44,7,2,44.99),(44,10,1,69.99),(44,14,1,49.99),
(45,1,1,19.99),(45,5,1,49.99),(45,8,1,89.99),(45,11,2,29.99),
(46,2,2,39.99),(46,6,1,59.99),(46,9,1,120.00),(46,12,1,34.99),
(47,3,1,24.99),(47,7,1,44.99),(47,10,2,69.99),(47,13,1,19.99),
(48,4,2,29.99),(48,5,1,49.99),(48,8,1,89.99),(48,14,1,49.99),

(49,1,1,19.99),(49,6,2,59.99),(49,9,1,120.00),(49,11,1,29.99),
(50,2,1,39.99),(50,7,2,44.99),(50,10,1,69.99),(50,12,1,34.99),
(51,3,2,24.99),(51,5,1,49.99),(51,8,1,89.99),(51,13,1,19.99),
(52,4,1,29.99),(52,6,1,59.99),(52,9,2,120.00),(52,14,1,49.99),
(53,1,2,19.99),(53,7,1,44.99),(53,10,1,69.99),(53,11,1,29.99),
(54,2,1,39.99),(54,5,1,49.99),(54,8,2,89.99),(54,12,1,34.99)

ON CONFLICT DO NOTHING;
